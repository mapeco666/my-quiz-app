<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <title>トイレ用: 表紙10秒表示→問題→回答ループ</title>
  <link rel="stylesheet" href="styles.css">
</head>
<body class="cover-mode">
  <div class="content-center">

    <!-- 表紙用コンテナ -->
    <div id="cover-container" class="main-container" style="display: block;">
      <!-- 表紙は音だけで、テキストなし -->
    </div>

    <!-- 問題用コンテナ -->
    <div id="question-container" class="main-container" style="display: none;">
      <p id="question">問題がここに表示されます</p>
      <p id="supplement" class="small-text">補足がここに表示されます</p>
    </div>

    <!-- 回答用コンテナ -->
    <div id="answer-container" class="main-container" style="display: none;">
      <p id="answer">答えがここに表示されます</p>
      <p id="explanation" class="small-text">解説がここに表示されます</p>
    </div>

  </div><!-- /content-center -->

  <script>
    let questions = [];
    let currentTimeout = null;

    // ===============================
    // ページ読み込みでCSVを取得
    // ===============================
    window.onload = () => {
      loadCSV();
    };

    function loadCSV() {
      fetch('questions.csv')
        .then(response => response.text())
        .then(data => {
          const lines = data.split('\n').filter(line => line.trim() !== '');
          questions = lines.slice(1).map(line => {
            const [question, answer, supplement, explanation] = line.split(',');
            return { question, answer, supplement, explanation };
          });
          startFlow();
        })
        .catch(err => console.error('Error loading CSV:', err));
    }

    // ===============================
    // フロー開始（表紙10秒表示）
    // ===============================
    function startFlow() {
      showCover();
    }

    function showCover() {
      clearTimeout(currentTimeout);

      // 表紙を表示、他を隠す
      document.getElementById('cover-container').style.display = 'block';
      document.getElementById('question-container').style.display = 'none';
      document.getElementById('answer-container').style.display = 'none';

      document.body.classList.add('cover-mode');
      document.body.classList.remove('question-mode', 'answer-mode');

      // ★1秒遅らせて音声再生
      setTimeout(() => {
        const coverAudio = new Audio('cover-sound.mp3');
        coverAudio.play().catch(err => {
          console.log("表紙の音が再生されませんでした:", err);
        });
      }, 1000);

      // ★10秒後に問題回答ループを開始
      currentTimeout = setTimeout(() => {
        loopQuestionAnswer();
      }, 10000);
    }

    // ===============================
    // 問題→回答のループ
    // ===============================
    function loopQuestionAnswer() {
      showQuestion();
      currentTimeout = setTimeout(() => {
        showAnswer();
        currentTimeout = setTimeout(() => {
          loopQuestionAnswer();
        }, 15000);
      }, 15000);
    }

    function showQuestion() {
      clearTimeout(currentTimeout);

      const randomIndex = Math.floor(Math.random() * questions.length);
      const picked = questions[randomIndex];

      document.getElementById('question').innerHTML = picked.question;
      document.getElementById('supplement').innerHTML = picked.supplement;
      document.getElementById('answer').innerHTML = picked.answer;
      document.getElementById('explanation').innerHTML = picked.explanation;

      document.getElementById('cover-container').style.display = 'none';
      document.getElementById('question-container').style.display = 'block';
      document.getElementById('answer-container').style.display = 'none';

      document.body.classList.add('question-mode');
      document.body.classList.remove('cover-mode', 'answer-mode');

      const questionAudio = new Audio('question-sound.mp3');
      questionAudio.play().catch(err => {
        console.log("問題の音が再生されませんでした:", err);
      });
    }

    function showAnswer() {
      clearTimeout(currentTimeout);

      document.getElementById('question-container').style.display = 'none';
      document.getElementById('answer-container').style.display = 'block';

      document.body.classList.add('answer-mode');
      document.body.classList.remove('question-mode', 'cover-mode');

      const answerAudio = new Audio('answer-sound.mp3');
      answerAudio.play().catch(err => {
        console.log("回答の音が再生されませんでした:", err);
      });
    }
  </script>
</body>
</html>
